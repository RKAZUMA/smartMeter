<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<title> smart meter </title>
	<link rel="stylesheet" type="text/css" href="dj.css" />

	<!-- -->
	<script type="text/javascript">
		/*
		 for debugging while using local files I'd like to set the baseURL to my 
		 first smartmeter at home otherwise the baseURL should be an empty string 
		 an all further requests relative to the original document
		 */
		var baseURL = "",
			myUrl = document.URL.split("/index.html")[0];

		if (!window.location.origin)
			window.location.origin = window.location.protocol+"//"+window.location.host;
		baseURL = window.location.origin;
		console.log ("baseURL="+baseURL);
		console.log ("document.URL: "+document.URL);


     	if (!document.URL.indexOf("file://")) {
     		console.log ("this is a dev system on "+document.URL);
     		baseURL="http://entrance.leichsenring.net:42080/";     		
     		baseURL="http://krukas.no-ip.org:42080";     		
     	}
	</script>

	<script src="getEnergyObject.js" type="text/javascript"></script>
	<script src="plotData.js" type="text/javascript"></script>
	<script src="/socket.io/socket.io.js" type="text/javascript"></script>
	<script src="http://mbostock.github.io/protovis/protovis-r3.2.js" type="text/javascript"></script>
	<script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script>
</head>


<body>

	<div id="rad">
		<div id="elem-background"></div>
		<div id="elem-window"></div>
		<div id="elem3"></div>
		<div id="line"></div>
	</div>

	<script type="text/javascript">

var eo = new energyObject({
		title: "smart meter",
		webSocketDomain: baseURL,  // for the webSocket, on which new data will be listened on
		URL: baseURL + '/smartMeter' // for the get data request
	})
	.listenOnGotDataEvent()
	.getGlobalData()
	.getData(1000);		

var xpos = 50,
 	xstart = xpos,
 	screenWidth = $(window).width(),
 	step = 1,
 	height = 5,
 	ypos = 0,
 	speed = screenWidth
 	;

$('#rad').css({'width':screenWidth-2*xstart, 'height':height, 'background-color':'#cccccc', 'left':xstart, 'top':ypos, 'position':'absolute'});
$('#elem-background').css({'width':(screenWidth-3*xstart), 'height':height, 'background-color':'rgb(212,212,212)', 'left':xstart, 'top':ypos, 'position':'absolute'});
$('#elem-window').css({'width':(3*xstart), 'height':height, 'background-color':'rgb(212,212,212)', 'left':xstart, 'top':ypos, 'position':'absolute'});

//Function to draw a vertical line
function draw_vertical_line(width, height, linecolor, xpos, ypos) {
    $('#line').css({'width':width, 'height':height, 'background-color':linecolor, 'left':xpos, 'top':ypos, 'position':'absolute'});
		}

setInterval(
 	function() {
      	draw_vertical_line(42, 5, 'rgb(255,0,0)', xpos, 0);
      	xpos += step;
      	if ( xpos > screenWidth - 3*xstart) xpos = 0;
		}, 
	1000);
	

	</script>

</body>
</html>
